!function(){"use strict";angular.module("app.file",[]).factory("fileService",["$http","$q","$log","constants","localize","notification","storage","fileLoader","userService","sharePointFileService","oneDriveFileService",function(i,e,r,I,n,l,o,E,O,N,s){var a=I.USER_TYPE.NONE;function f(e,t){var n;O.getUserType().then(function(i){n=function(i){var e=null;switch(i){case I.USER_TYPE.O365:e=N;break;case I.USER_TYPE.MSA:e=s;break;default:l.show(I.NOTIFICATION.NOTSIGNEDIN),r.trackEvent("FileUserTypeError_UserNotSignedIn")}return e}(a=i),Utilities.isUndefinedOrNull(n)?t(null):(r.trackEvent("FileServiceProviderUploadDocType_"+Utilities.getFileExtension(e.name)),l.show(I.NOTIFICATION.FILE_UPLOAD_IN_PROGRESS),n.doUpload(e,function(i,e,n){Utilities.isUndefinedOrNull(i)&&function(i,e){if(Utilities.isUndefinedOrNull(e)||Utilities.isUndefinedOrNull(i))return;415===e?l.show(I.NOTIFICATION.FILE_UPLOAD_FAILURE_UNSUPPORTED_MEDIA):502===e||503===e||509===e?l.show(I.NOTIFICATION.FILE_UPLOAD_FAILURE_SERVER):(r.error(String.format("fileService.doUpload - {0} - {1}",e,JSON.stringify(i))),l.show(I.NOTIFICATION.FILE_UPLOAD_FAILURE_GENERIC))}(e,n),t(i)}))})}return{upload:function(i,e,t){if(Utilities.isUndefinedOrNull(i)||e!==I.FILE.ORIGIN.HTML5&&e!==I.FILE.ORIGIN.LOCAL_PATH)return r.error(String.format("fileService.upload(): Invalid argument: fileInfo: {0}, fileOrigin: {1}",JSON.stringify(i),e)),void t(null);E.loadFile(i,e).then(function(i){f(i,function(n){Utilities.isUndefinedOrNull(n)?t(null):o.get("displayAutoSaveNotification").then(function(i){if(Utilities.isUndefinedOrNull(i.displayAutoSaveNotification)||!0===i.displayAutoSaveNotification){var e=I.NOTIFICATION.AUTOSAVE;e.message=a===I.USER_TYPE.MSA?I.NOTIFICATION.AUTOSAVETOONEDRIVE:I.NOTIFICATION.AUTOSAVETOSHAREPOINT,l.show(e)}t(n)})})},function(i){!function(i){if(Utilities.isUndefinedOrNull(i))return;switch(i){case I.FILE.ERROR.FILE_SIZE_MAX_EXCEEDED:l.show(I.NOTIFICATION.FILE_MAX_SIZE_BYTE_LIMIT_REACHED);break;case I.FILE.ERROR.UNSUPPORTED_FILE_TYPE:l.show(I.NOTIFICATION.UNSUPPORTEDFILETYPE);break;default:r.error(String.format("fileService.loadFile - {0}",i)),l.show(I.NOTIFICATION.FILE_UPLOAD_FAILURE_GENERIC)}}(i),t(null)})}}}])}();