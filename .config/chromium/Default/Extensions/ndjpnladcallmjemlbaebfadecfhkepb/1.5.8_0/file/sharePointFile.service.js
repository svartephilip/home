!function(){"use strict";angular.module("app.file").service("sharePointFileService",["$http","$log","constants","localize","userService",function(l,d,a,s,o){this.doUpload=function(r,t){var e,i,n;r.name=(e=r.name,i=(new Date).toISOString(),n=i.replace(/(\d+)-(\d+)-(\d+)T(\d+):(\d+):(\d+).+/,"_$1$2$3_$4$5$6."),e.replace(".",n)),o.getUserInfo(a.USER_TYPE.O365,function(e){if(Utilities.isUndefinedOrNull(e)||Utilities.isUndefinedOrNull(e.serviceInfo))return d.error("sharePointFileService.doUpload - Invalid serviceInfo"),void t(null);var i=e.serviceInfo,n=i.url+"/drive/root:/"+encodeURIComponent(s.getLocalizedString("AppFolderName"))+"/"+r.name+":/content",o={method:"PUT",url:n,headers:{"Content-Type":"application/octet-stream","X-UserType":a.USER_TYPE.O365,"X-Resource":i.resource},data:r.content,transformRequest:[]};l(o).success(function(e,i){var n="",o="";return Utilities.isUndefinedOrNull(e.eTag)?(d.error("sharePointFileService.doUpload - Missing eTag"),void t(null,e,i)):(n=e.eTag.substring(1,e.eTag.indexOf(",")),Utilities.isUndefinedOrNull(e["@content.downloadUrl"])?(d.error("sharePointFileService.doUpload - Missing downloadUrl"),void t(null,e,i)):(o=e["@content.downloadUrl"].replace(/download.aspx?.+/,"WopiFrame.aspx?sourcedoc="+n),d.debug(String.format("sharePointFileService.doUpload - {0} - {1}",i,o)),void t(o)))}).error(function(e,i){t(null,e,i)})})}}])}();